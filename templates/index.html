<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∏—Ä –ö–Ω–∏–≥ - –ì–ª–∞–≤–Ω–∞—è</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 100px 0;
            margin-bottom: 50px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container">
            <li class="nav-item">
    <a class="nav-link" href="/cart">–ö–æ—Ä–∑–∏–Ω–∞</a>
</li>
<span class="badge bg-primary me-2" id="cartBadge">0</span>
<a class="btn btn-outline-primary me-2" href="/cart">
    üõí –ö–æ—Ä–∑–∏–Ω–∞
</a>
            <a class="navbar-brand" href="/">–ú–∏—Ä –ö–Ω–∏–≥</a>
            <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">–ì–ª–∞–≤–Ω–∞—è</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/products">–¢–æ–≤–∞—Ä—ã</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/products" id="adminLink" style="display: none;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</a>
                    </li>
                </ul>
                
                <!-- –ö–ù–û–ü–ö–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò -->
                <div class="d-flex align-items-center" id="authButtons">
                    <!-- –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div id="guestButtons">
                        <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#loginModal">
                            –í–æ–π—Ç–∏
                        </button>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#registerModal">
                            –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                        </button>
                    </div>
                    
                    <!-- –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div id="userButtons" style="display: none;">
                        <span class="me-3">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <strong id="userName"></strong>!</span>
                        <button class="btn btn-outline-secondary" onclick="logout()">
                            –í—ã–π—Ç–∏
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">–í–æ–π—Ç–∏</button>
                    </form>
                    <div class="text-center mt-3">
                        <span>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="modal fade" id="registerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="registerName" class="form-label">–ò–º—è</label>
                            <input type="text" class="form-control" id="registerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="registerEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" class="form-control" id="registerPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </form>
                    <div class="text-center mt-3">
                        <span>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">–í–æ–π–¥–∏—Ç–µ</a></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <div class="jumbotron bg-light p-5 rounded">
            <h1 class="display-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú–∏—Ä –ö–Ω–∏–≥!</h1>
            <p class="lead">–õ—É—á—à–∏–π –≤—ã–±–æ—Ä –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è –≤—Å–µ—Ö –≤–æ–∑—Ä–∞—Å—Ç–æ–≤ –∏ –≤–∫—É—Å–æ–≤.</p>
            <hr class="my-4">
            <p>–û—Ç –∫–ª–∞—Å—Å–∏–∫–∏ –¥–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–µ—Å—Ç—Å–µ–ª–ª–µ—Ä–æ–≤ - –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.</p>
            <a class="btn btn-primary btn-lg" href="/products" role="button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä—ã</a>
        </div>
    </div>
    
    <script src="/static/js/bootstrap.min.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let isAdmin = false;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                loginUser(email, password);
            });

            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                registerUser(name, email, password);
            });
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function checkAuthStatus() {
            try {
                const response = await fetch('/api/user');
                const result = await response.json();
                
                if (result.logged_in) {
                    currentUser = result.user;
                    isAdmin = result.user.is_admin;
                    updateUI();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
            }
        }

        // –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loginUser(email, password) {
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({email: email, password: password})
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser = result.user;
                    isAdmin = result.user.is_admin;
                    updateUI();
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    loginModal.hide();
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('loginForm').reset();
                    
                    alert('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + result.user.name + '!');
                } else {
                    alert(result.message);
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerUser(name, email, password) {
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({name: name, email: email, password: password})
                });
                
                const result = await response.json();
                if (result.success) {
                    currentUser = result.user;
                    isAdmin = result.user.is_admin;
                    updateUI();
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                    registerModal.hide();
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('registerForm').reset();
                    
                    alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + name + '!');
                } else {
                    alert(result.message);
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
            }
        }

        // –í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function logout() {
            try {
                const response = await fetch('/api/logout');
                const result = await response.json();
                
                if (result.success) {
                    currentUser = null;
                    isAdmin = false;
                    updateUI();
                    alert('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞');
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            const guestButtons = document.getElementById('guestButtons');
            const userButtons = document.getElementById('userButtons');
            const userName = document.getElementById('userName');
            const adminLink = document.getElementById('adminLink');
            
            if (currentUser) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                guestButtons.style.display = 'none';
                userButtons.style.display = 'block';
                userName.textContent = currentUser.name;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∞–¥–º–∏–Ω–∫—É —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
                if (isAdmin) {
                    adminLink.style.display = 'block';
                } else {
                    adminLink.style.display = 'none';
                }
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≥–æ—Å—Ç—è
                guestButtons.style.display = 'block';
                userButtons.style.display = 'none';
                adminLink.style.display = 'none';
            }
        }
    </script>
</body>
</html>